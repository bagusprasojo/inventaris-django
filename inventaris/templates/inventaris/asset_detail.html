{% extends 'inventaris/base.html' %}
{% block title %}Detail Aset{% endblock %}
{% block content %}
<h1 class="h4">Detail Aset</h1>
<div class="card mt-3">
    <div class="card-body">
        <dl class="row mb-0">
            <dt class="col-sm-3">Kode</dt>
            <dd class="col-sm-9">{{ asset.code }}</dd>
            <dt class="col-sm-3">Nama</dt>
            <dd class="col-sm-9">{{ asset.name }}</dd>
            <dt class="col-sm-3">Kategori</dt>
            <dd class="col-sm-9">{{ asset.category }}</dd>
            <dt class="col-sm-3">Lokasi</dt>
            <dd class="col-sm-9">{{ asset.current_location }}</dd>
            <dt class="col-sm-3">Status</dt>
            <dd class="col-sm-9">{{ asset.get_status_display }}</dd>
            <dt class="col-sm-3">Kondisi</dt>
            <dd class="col-sm-9">{{ asset.get_condition_display }}</dd>
            <dt class="col-sm-3">Tanggal Perolehan</dt>
            <dd class="col-sm-9">{{ asset.acquired_date }}</dd>
        </dl>
    </div>
</div>
<div class="mt-3">
    <a class="btn btn-primary" href="{% url 'inventaris:asset_update' asset.pk %}">Edit</a>
    <a class="btn btn-outline-success" href="{% url 'inventaris:asset_label' asset.pk %}">Cetak Label</a>
    {% if not asset.deleted_at %}
    <a class="btn btn-outline-danger" href="{% url 'inventaris:asset_delete' asset.pk %}">Hapus</a>
    {% endif %}
    <a class="btn btn-secondary" href="{% url 'inventaris:asset_list' %}">Kembali</a>
</div>
<div class="mt-4">
    <ul class="nav nav-tabs" id="asset-tabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="tab-lokasi" data-bs-toggle="tab" data-bs-target="#pane-lokasi" type="button" role="tab">Riwayat Lokasi</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-foto" data-bs-toggle="tab" data-bs-target="#pane-foto" type="button" role="tab">Foto Aset</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-meter" data-bs-toggle="tab" data-bs-target="#pane-meter" type="button" role="tab">Meter Reading</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-pinjam" data-bs-toggle="tab" data-bs-target="#pane-pinjam" type="button" role="tab">Riwayat Peminjaman</button>
        </li>
    </ul>
    <div class="tab-content border border-top-0 p-3">
        <div class="tab-pane fade show active" id="pane-lokasi" role="tabpanel">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h2 class="h6 mb-0">Riwayat Lokasi</h2>
                <a class="btn btn-outline-primary btn-sm" href="{% url 'inventaris:asset_move' asset.pk %}">Mutasi Lokasi</a>
            </div>
            <table class="table table-bordered table-sm">
                <thead>
                    <tr>
                        <th>Dari</th>
                        <th>Ke</th>
                        <th>Tanggal</th>
                        <th>Oleh</th>
                    </tr>
                </thead>
                <tbody>
                {% for item in location_histories %}
                    <tr>
                        <td>{{ item.from_location|default:"-" }}</td>
                        <td>{{ item.to_location }}</td>
                        <td>{{ item.moved_at }}</td>
                        <td>{{ item.moved_by }}</td>
                    </tr>
                {% empty %}
                    <tr><td colspan="4" class="text-center">Belum ada data</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="tab-pane fade" id="pane-foto" role="tabpanel">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h2 class="h6 mb-0">Foto Aset</h2>
                <a class="btn btn-outline-primary btn-sm" href="{% url 'inventaris:asset_photo_create' asset.pk %}">Tambah Foto</a>
            </div>
            <div class="row g-3">
                {% for photo in asset_photos %}
                <div class="col-md-3">
                    <div class="card">
                        <img src="{{ photo.image.url }}" class="card-img-top" alt="Foto">
                        <div class="card-body">
                            <div class="small">{{ photo.caption|default:"-" }}</div>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-12">
                    <div class="text-muted">Belum ada foto</div>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="tab-pane fade" id="pane-meter" role="tabpanel">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h2 class="h6 mb-0">Meter Reading</h2>
                <a class="btn btn-outline-primary btn-sm" href="{% url 'inventaris:asset_meter_create' asset.pk %}">Tambah Reading</a>
            </div>
            <table class="table table-bordered table-sm">
                <thead>
                    <tr>
                        <th>Tipe</th>
                        <th>Nilai</th>
                        <th>Waktu Catat</th>
                        <th>Oleh</th>
                        <th>Catatan</th>
                    </tr>
                </thead>
                <tbody>
                {% for item in meter_readings %}
                    <tr>
                        <td>{{ item.get_reading_type_display }}</td>
                        <td>{{ item.reading_value }}</td>
                        <td>{{ item.reading_at }}</td>
                        <td>{{ item.recorded_by }}</td>
                        <td>{{ item.note|default:"-" }}</td>
                    </tr>
                {% empty %}
                    <tr><td colspan="5" class="text-center">Belum ada data</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="tab-pane fade" id="pane-pinjam" role="tabpanel">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h2 class="h6 mb-0">Riwayat Peminjaman</h2>
                <a class="btn btn-outline-primary btn-sm" href="{% url 'inventaris:loan_create' %}">Tambah Peminjaman</a>
            </div>
            <table class="table table-bordered table-sm">
                <thead>
                    <tr>
                        <th>Peminjam</th>
                        <th>Tanggal Pinjam</th>
                        <th>Rencana Kembali</th>
                        <th>Tanggal Kembali</th>
                    </tr>
                </thead>
                <tbody>
                {% for item in loan_histories %}
                    <tr>
                        <td>{{ item.borrower }}</td>
                        <td>{{ item.borrowed_at }}</td>
                        <td>{{ item.planned_return_at }}</td>
                        <td>{{ item.returned_at|default:"-" }}</td>
                    </tr>
                {% empty %}
                    <tr><td colspan="4" class="text-center">Belum ada data</td></tr>
                {% endfor %}
                </tbody>
            </table>
            <a class="btn btn-outline-secondary btn-sm" href="{% url 'inventaris:loan_list' %}">Lihat semua peminjaman</a>
        </div>
    </div>
</div>
{% endblock %}
